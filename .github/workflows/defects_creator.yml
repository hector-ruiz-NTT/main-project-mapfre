name: Agente creador de defectos

on:
  workflow_dispatch:
    inputs:
      xml_file:
        description: "Ruta del archivo XML de entrada (debe existir en el repositorio)"
        required: true
        default: "input"

jobs:
  crear-defecto:
    runs-on: self-hosted
    env:
      OCTANE_URL: ${{ secrets.OCTANE_URL }}
      OCTANE_CLIENT_ID: ${{ secrets.OCTANE_CLIENT_ID }}
      OCTANE_CLIENT_SECRET: ${{ secrets.OCTANE_CLIENT_SECRET }}
      OCTANE_SHARED_SPACE: ${{ secrets.OCTANE_SHARED_SPACE }}
      OCTANE_WORKSPACE: ${{ secrets.OCTANE_WORKSPACE }}
      AZURE_OPENAI_API_KEY: ${{ secrets.AZURE_OPENAI_API_KEY }}
      AZURE_OPENAI_API_VERSION: ${{ secrets.AZURE_OPENAI_API_VERSION }}
      AZURE_OPENAI_ENDPOINT: ${{ secrets.AZURE_OPENAI_ENDPOINT }}
      AZURE_OPENAI_DEPLOYMENT: ${{ secrets.AZURE_OPENAI_DEPLOYMENT }}

    steps:
      - name: Checkout repositorio
        uses: actions/checkout@v3

      - name: Instalar dependencias
        run: |
          pip install -r requirements.txt

      - name: Ejecutar script de clasificación y creación de defecto desde XML
        run: |
          python create_defect_from_xml.py "${{ github.event.inputs.xml_file }}"